<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Cadastro de OS</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f4f4f4;
    }
    h2 {
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      margin-bottom: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
    }
    th {
      background: #eaeaea;
    }
    input, select {
      width: 100%;
      box-sizing: border-box;
      border: none;
      padding: 6px;
    }
    button {
      padding: 10px 20px;
      margin-right: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>Formulário de Cadastro de OS</h2>

  <table id="osTable">
    <thead>
      <tr>
        <th>Identificador</th>
        <th>Tipo de OS</th>
        <th>Documento do cliente</th>
        <th>Nome do cliente</th>
        <th>Nome da localização</th>
        <th>Número de série</th>
        <th>Nome do colaborador</th>
        <th>Nomes dos colaboradores secundários</th>
        <th>Data de agendamento</th>
        <th>Hora de agendamento</th>
        <th>Descrição</th>
        <th>Descrição da tarefa</th>
        <th>Etiquetas</th>
      </tr>
    </thead>
    <tbody id="formBody">
      <tr>
        <td><input type="text" /></td>
        <td>
          <select>
            <option value="OXXO - Sustentação">OXXO - Sustentação</option>
          </select>
        </td>
        <td><input type="text" /></td>
        <td>
          <select>
            <option value="OXXO">OXXO</option>
          </select>
        </td>
        <td><input list="localizacoes" /></td>
        <td><input type="text" /></td>
        <td><input type="text" /></td>
        <td><input type="text" /></td>
        <td><input type="date" /></td>
        <td><input type="time" /></td>
        <td><input type="text" /></td>
        <td><input type="text" /></td>
        <td><input type="text" /></td>
      </tr>
    </tbody>
  </table>

  <datalist id="localizacoes"></datalist>

  <button onclick="addRow()">Adicionar Linha</button>
  <button onclick="exportToExcel()">Exportar para Excel</button>

  <script>
    // Preencher datalist com localizações da planilha
    fetch('localizacoes.xlsx')
      .then(res => res.arrayBuffer())
      .then(buffer => {
        const workbook = XLSX.read(buffer, { type: 'array' });
        const sheet = workbook.Sheets["Planilha1"];
        const data = XLSX.utils.sheet_to_json(sheet, { header: 1 });

        const list = document.getElementById('localizacoes');
        data.forEach((row, i) => {
          if (i === 0) return; // pular cabeçalho
          if (row[0]) {
            const option = document.createElement('option');
            option.value = row[0];
            list.appendChild(option);
          }
        });
      });

    function addRow() {
      const tbody = document.getElementById("formBody");
      const row = document.createElement("tr");

      for (let i = 0; i < 13; i++) {
        const cell = document.createElement("td");

        if (i === 1) {
          const select = document.createElement("select");
          const option = document.createElement("option");
          option.value = "OXXO - Sustentação";
          option.text = "OXXO - Sustentação";
          select.appendChild(option);
          cell.appendChild(select);
        } else if (i === 3) {
          const select = document.createElement("select");
          const option = document.createElement("option");
          option.value = "OXXO";
          option.text = "OXXO";
          select.appendChild(option);
          cell.appendChild(select);
        } else if (i === 4) {
          const input = document.createElement("input");
          input.setAttribute("list", "localizacoes");
          cell.appendChild(input);
        } else {
          const input = document.createElement("input");
          input.type = (i === 8) ? "date" : (i === 9 ? "time" : "text");
          cell.appendChild(input);
        }

        row.appendChild(cell);
      }

      tbody.appendChild(row);
    }

    function exportToExcel() {
      const table = document.getElementById("osTable");
      const ws = XLSX.utils.table_to_sheet(table, { raw: true });
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "OS");
      XLSX.writeFile(wb, "ordens_servico.xlsx");
    }
  </script>
</body>
</html>
